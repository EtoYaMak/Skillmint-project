import { useState } from "react";
import { useDispatch } from "react-redux";
import { deleteJob } from "../features/jobs/jobSlice";
import { FaClock, FaCog, FaEdit, FaTrash, FaTimes } from "react-icons/fa";

function DashJobCard({ job }) {
  const dispatch = useDispatch();
  const [dropdownOpen, setDropdownOpen] = useState(false);

  const toggleDropdown = () => {
    setDropdownOpen(!dropdownOpen);
  };

  const currentDate = new Date();
  const jobDate = new Date(job.createdAt);
  const timeDifference = currentDate - jobDate;
  const minutesSinceJobWasPosted = Math.floor(timeDifference / (1000 * 60));
  const hoursSinceJobWasPosted = Math.floor(timeDifference / (1000 * 60 * 60));
  const daysSinceJobWasPosted = Math.floor(
    timeDifference / (1000 * 60 * 60 * 24)
  );
  const weeksSinceJobWasPosted = Math.floor(
    timeDifference / (1000 * 60 * 60 * 24 * 7)
  );

  let timeSinceJobWasPosted = "";

  if (weeksSinceJobWasPosted > 0) {
    timeSinceJobWasPosted = `${weeksSinceJobWasPosted} Weeks ago`;
  } else if (daysSinceJobWasPosted > 0) {
    timeSinceJobWasPosted = `${daysSinceJobWasPosted} Days ago`;
  } else if (hoursSinceJobWasPosted > 0) {
    timeSinceJobWasPosted = `${hoursSinceJobWasPosted} hours ago`;
  } else {
    timeSinceJobWasPosted = `${minutesSinceJobWasPosted} minutes ago`;
  }

  const handleEditOption = () => {
    // Handle edit option functionality
  };

  const handleDeleteOption = () => {
    const confirmDelete = window.confirm(
      "Are you sure you want to delete this job?"
    );
    if (confirmDelete) {
      dispatch(deleteJob(job._id));
    }
  };

  const handleCloseOption = () => {
    setDropdownOpen(false);
  };

  return (
    <div className="Main Tile w-full py-2">
      <div className="Second flex shadow-sm shadow-gray-500/50 rounded-md px-1 py-4">
        {/* JobCard */}
        <div className="ThirdOne flex items-center px-2 space-x-6 bg-inherit">
          <img
            src={job.logo}
            alt={job.position}
            className="w-20 h-20 rounded-full"
          />
          <div className="bg-inherit">
            <h2 className="text-xl font-bold text-gray-800 w-64">
              {job.position}
            </h2>
            <h3 className="text-sm text-gray-600">{job.company}</h3>
          </div>
        </div>
        {/* JobCard End*/}

        {/* TIME */}
        <div className="ThirdTwo px-2 flex items-center space-x-6 bg-transparent w-40">
          <div className="flex items-center space-x-2 bg-inherit">
            <FaClock className="text-gray-600" />
            <span className="text-md text-gray-600">
              {timeSinceJobWasPosted}
            </span>
          </div>
        </div>
        {/* TIME END*/}

        {/* COG WHEEL */}
        <div className="flex items-center px-2">
          <button
            className="cog-wheel bg-blue-500 hover:bg-blue-600 font-semibold rounded-full w-12 h-12 flex items-center justify-center"
            onClick={toggleDropdown}
          >
            <FaCog className="w-5 h-5 text-white bg-transparent" />
          </button>
          {dropdownOpen && (
            <div className="dropdown-menu absolute ml-[-8em] mt-1 bg-gray-50 rounded shadow-sm shadow-gray-400/50  text-white p-2 animate-fadeIn">
              <button
                className="dropdown-option flex items-center rounded-md py-2 px-4 w-full text-gray-800 hover:bg-gray-600 hover:text-white hover:font-semibold transition duration-300"
                onClick={handleEditOption}
              >
                <FaEdit className="mr-2 w-5 h-5 bg-transparent" />
                Edit
              </button>
              <button
                className="dropdown-option flex items-center rounded-md py-2 px-4 w-full text-gray-800 hover:bg-gray-600 hover:text-white hover:font-semibold transition duration-300"
                onClick={handleDeleteOption}
              >
                <FaTrash className="mr-2 w-5 h-5 bg-transparent" />
                Delete
              </button>
              <button
                className="dropdown-option flex items-center rounded-md py-2 px-4 w-full text-gray-800 hover:bg-gray-600 hover:text-white hover:font-semibold transition duration-300"
                onClick={handleCloseOption}
              >
                <FaTimes className="mr-2 w-5 h-5 bg-transparent" />
                Close
              </button>
            </div>
          )}
        </div>
        {/* COG WHEEL END */}
      </div>
    </div>
  );
}

export default DashJobCard;
